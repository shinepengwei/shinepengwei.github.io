---
layout: post
title: 类型转换中如何适当使用static_cast/const_cast/dynamic_cast/reinterpret_cast[译]
category: "编程"
tag: "C++"

---
<p>原文转自：<a href="http://stackoverflow.com/questions/332030/when-should-static-cast-dynamic-cast-and-reinterpret-cast-be-used">http://stackoverflow.com/questions/332030/when-should-static-cast-dynamic-cast-and-reinterpret-cast-be-used</a>
	</p><p><span style="color:black; font-size:8pt"><span style="font-family:Arial">dynamic_cast</span><span style="font-family:宋体">：用于指针</span><span style="font-family:Arial">/</span><span style="font-family:宋体">引用在继承树的转换。</span><span style="font-family:Arial">Run-time.
</span></span></p><p><span style="color:black; font-size:8pt"><span style="font-family:Arial">static_cast</span><span style="font-family:宋体">：通常的类型转换。</span><span style="font-family:Arial">
			</span></span></p><p><span style="color:black; font-size:8pt"><span style="font-family:Arial">reinterpret_cast</span><span style="font-family:宋体">：位模式和极端情况使用。</span><span style="font-family:Arial">
			</span></span></p><p><span style="color:black; font-size:8pt"><span style="font-family:Arial">const_cast</span><span style="font-family:宋体">：用于转换掉</span><span style="font-family:Arial">const</span><span style="font-family:宋体">。几乎没有人使用。</span><span style="font-family:Arial">
			</span></span></p><p style="background: white">
?</p><p style="background: white">
?</p><p style="background: white">
?</p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:宋体">一般来说，</span><span style="font-family:Arial"><strong>static_cast</strong></span><span style="font-family:宋体">用于常见的类型转换。它的作用好像是一个隐式转换，而且他可以调用显式或隐式的转换函数。再大部分场合，显示的声明</span><span style="font-family:Arial">static_cast</span><span style="font-family:宋体">是没有必要的，可以直接使用</span><span style="font-family:Arial">T(something)</span><span style="font-family:宋体">或者</span><span style="font-family:Arial">(T)something</span><span style="font-family:宋体">。</span><span style="font-family:Arial">
			</span></span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:Arial">Static_cast</span><span style="font-family:宋体">可以用于类的层次结构中。当派生类转换为基类时是不需要使用的，当基类转换为派生类时，就可以使用</span><span style="font-family:Arial">static_cast</span><span style="font-family:宋体">，只要不牵扯到虚继承。它不会进行类型检查，但是如果使用</span><span style="font-family:Arial">static_cast</span><span style="font-family:宋体">将一个基类转换为这个对象根本不是的派生类，则是一个编译错误（</span><span style="font-family:Arial">undefined behavior</span><span style="font-family:宋体">）。</span><span style="font-family:Arial">
			</span></span></p><p><img src="http://www.codingart.info/wp-content/uploads/2013/04/042313_1403_stat1.png" alt=""/><span style="font-family:宋体; font-size:12pt">
		</span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:Consolas"><strong>const_cast</strong></span><span style="font-family:宋体">用于添加或删除变量的</span><span style="font-family:Consolas">const</span><span style="font-family:宋体">修饰词，</span><span style="font-family:Consolas">C++</span><span style="font-family:宋体">中没有其他的转换方式可以完成这个功能。这个功能貌似很少有人用到。</span><span style="font-family:Arial">
			</span></span></p><p><img src="http://www.codingart.info/wp-content/uploads/2013/04/042313_1403_stat2.png" alt=""/><span style="font-family:宋体; font-size:12pt">
		</span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:Consolas"><strong>dynamic_cast</strong></span><span style="font-family:宋体">几乎是专门用于处理多态问题，并且只能用于指针或者引用。可以使用它将一个指向多态类型的指针或引用转换为其他类型。（多态类型表示至少定义或者继承了一个虚函数）。它可以用于将基类转换为派生类，它如果是这个派生类，那么就会返回这个派生类对象或指针，否则返回指针</span><span style="font-family:Consolas">NULL</span><span style="font-family:宋体">，如果是用于引用，则抛出异常</span><span style="font-family:Consolas">std::bad_cast</span><span style="font-family:宋体">。</span><span style="font-family:Consolas">
			</span></span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:Consolas"><strong>dynamic_cast</strong></span><span style="font-family:宋体">有一些限制，首先它不能用于在继承树中同一个类型有不同类型的对象（'</span><span style="font-family:Consolas">dreaded diamond</span><span style="font-family:宋体">'），其次，他不能用于没有多态的环境。还有，它只能用于</span><span style="font-family:Consolas">public</span><span style="font-family:宋体">继承，无法转换</span><span style="font-family:Consolas">protected</span><span style="font-family:宋体">和</span><span style="font-family:Consolas">private</span><span style="font-family:宋体">继承。</span><span style="font-family:Consolas"><strong>
				</strong></span></span></p><p><span style="color:black; font-size:8pt"><span style="font-family:宋体">（注：</span><span style="font-family:Arial">It doesn't work if there are multiple objects of the same type in the inheritance hierarchy (the so-called 'dreaded diamond')</span><span style="font-family:宋体">，是不是说一个基类如果有两个派生类就无法使用</span><span style="font-family:Arial">dynamic_cast</span><span style="font-family:宋体">）<img src="http://www.codingart.info/wp-content/uploads/2013/04/042313_1403_stat3.png" alt=""/></span></span><span style="font-family:宋体; font-size:12pt">
		</span></p><p style="background: white">
?</p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:Consolas"><strong>reinterpret_cast</strong></span><span style="font-family:Arial">?</span><span style="font-family:宋体">是一个非常危险的转换方法，必须小心的使用它。它将一种类型直接转换为另一种类型，如转换一个指针成为其他类型的变量，或者用</span><span style="font-family:Arial">int</span><span style="font-family:宋体">变量存储一个指针，等等</span><span style="font-family:Arial">nasty</span><span style="font-family:宋体">的操作。在使用</span><span style="font-family:Arial">reinterpret_cast</span><span style="font-family:宋体">的过程中，唯一可以保证的就是可以将转换后的结果原封不动的转换回来。</span><span style="font-family:Arial">reinterpret_cast</span><span style="font-family:宋体">主要用于特别奇怪的转换以及位操作，例如将原始数据流转换为真实数据。</span><span style="font-family:Arial">
			</span></span></p><p><img src="http://www.codingart.info/wp-content/uploads/2013/04/042313_1403_stat4.png" alt=""/><span style="font-family:宋体; font-size:12pt">
		</span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:Arial"><strong>C-style</strong></span><span style="font-family:宋体"><strong>转换</strong>使用</span><span style="font-family:Consolas">(type)object</span><span style="font-family:宋体">或者</span><span style="font-family:Consolas">type(object)</span><span style="font-family:宋体">。一个</span><span style="font-family:Consolas">C</span><span style="font-family:宋体">风格的转换定义为下列第一个成功的转换：</span><span style="font-family:Consolas"><strong>
				</strong></span></span></p><ul><li><span style="color:black; font-size:8pt"><span style="font-family:Consolas">const_cast</span><span style="font-family:Arial">
				</span></span></li><li><span style="color:black; font-size:8pt"><span style="font-family:Consolas">static_cast</span><span style="font-family:Arial">
				</span></span></li><li><span style="color:black; font-size:8pt"><span style="font-family:Consolas">static_cast</span><span style="font-family:Arial">, then?</span><span style="font-family:Consolas">const_cast</span><span style="font-family:Arial">
				</span></span></li><li><span style="color:black; font-size:8pt"><span style="font-family:Consolas">reinterpret_cast</span><span style="font-family:Arial">
				</span></span></li><li><span style="color:black; font-size:8pt"><span style="font-family:Consolas">reinterpret_cast</span><span style="font-family:Arial">, then?</span><span style="font-family:Consolas">const_cast</span><span style="font-family:Arial">
				</span></span></li></ul><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:宋体">因此在一些实例中它可以被用于其他转换的替代，但是由于它有可能变为</span><span style="font-family:Arial">reinterpret_cast</span><span style="font-family:宋体">，它是非常危险的。当需要显式转换时，一般使用</span><span style="font-family:Arial">C++</span><span style="font-family:宋体">风格，除非可以肯定</span><span style="font-family:Arial">static_cast</span><span style="font-family:宋体">可以成功或者</span><span style="font-family:Arial">reinterpret_cast</span><span style="font-family:宋体">会失败。</span><span style="font-family:Arial">
			</span></span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:宋体">当</span><span style="font-family:Arial">C-style</span><span style="font-family:宋体">转换执行</span><span style="font-family:Arial">static_cast</span><span style="font-family:宋体">还会忽略掉访问控制，也就是说可以执行一些其他转换不可以做的操作。</span><span style="font-family:Arial">
			</span></span></p><p style="background: white"><span style="color:black; font-size:8pt"><span style="font-family:宋体">综上所述，</span><span style="font-family:Arial">C-style</span><span style="font-family:宋体">转换应该避免。</span><span style="font-family:Arial">
			</span></span></p><p style="background: white">
?</p><p style="background: white"><span style="color:black; font-family:Arial; font-size:8pt">
		</span>?</p>
